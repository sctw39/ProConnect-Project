<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProConnect - Messages</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0078D4',
                        primaryLight: '#50A0E4',
                        primaryDark: '#106EBE',
                        secondary: '#2BC48A',
                        accent: '#FFB900',
                        danger: '#E74C3C',
                        success: '#27AE60',
                        lightBg: '#FFFFFF',
                        lightSecondary: '#F8F9FA',
                        lightTertiary: '#E9ECEF',
                        textDark: '#212529',
                        textMedium: '#495057',
                        textLight: '#6C757D'
                    }
                }
            }
        }
    </script>
    <style>
        .chat-bubble-received {
            border-radius: 18px 18px 18px 4px;
        }
        .chat-bubble-sent {
            border-radius: 18px 18px 4px 18px;
        }
    </style>
</head>
<body class="bg-lightBg text-textDark min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-md pb-20">
        <!-- App Header -->
        <header class="flex justify-between items-center mb-6">
            <a href="index.html" class="text-primary">
                <i class="fas fa-arrow-left text-xl"></i>
            </a>
            <h1 class="text-xl font-bold text-primary">Messages</h1>
            <button id="newMessageBtn" class="text-primary">
                <i class="fas fa-edit text-xl"></i>
            </button>
        </header>

        <!-- Main Content -->
        <main>
            <!-- Tabs -->
            <div class="flex border-b mb-4">
                <button class="text-primary border-b-2 border-primary pb-2 px-4 font-medium">Recent</button>
                <button class="text-textMedium pb-2 px-4 font-medium">Unread (3)</button>
                <button class="text-textMedium pb-2 px-4 font-medium">Archived</button>
            </div>

            <!-- Search Box -->
            <div class="mb-4">
                <div class="relative">
                    <input type="text" placeholder="Search messages" class="w-full px-4 py-2 pl-10 rounded-lg border focus:outline-none focus:ring-2 focus:ring-primary">
                    <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-textLight">
                        <i class="fas fa-search"></i>
                    </div>
                </div>
            </div>

            <!-- Authentication Check -->
            <div id="authCheck" class="hidden flex flex-col items-center justify-center py-8">
                <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mb-4">
                    <i class="fas fa-lock text-primary text-2xl"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">Sign in to view messages</h3>
                <p class="text-textMedium mb-4 text-center">Please sign in or create an account to access your messages</p>
                <div class="flex space-x-4">
                    <a href="index.html" class="bg-primary text-white px-6 py-2 rounded-lg">
                        Sign In
                    </a>
                    <a href="onboarding.html" class="bg-lightTertiary text-textDark px-6 py-2 rounded-lg">
                        Sign Up
                    </a>
                </div>
            </div>

            <!-- Messages List (Shown only if authenticated) -->
            <div id="messagesList" class="space-y-2">
                <!-- Active Chat (Sarah Chen) -->
                <div class="chat-item bg-primary/5 p-3 rounded-lg cursor-pointer" data-user="sarah" data-name="Sarah Chen" data-status="online" data-image="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=200&q=80">
                    <div class="flex items-center">
                        <div class="relative mr-3">
                            <img src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=200&q=80" class="w-12 h-12 rounded-full object-cover" alt="Profile photo">
                            <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <h3 class="font-medium">Sarah Chen</h3>
                                <span class="text-xs text-textLight">2 min ago</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <p class="text-sm text-textMedium truncate">Looking forward to our coffee chat tomorrow!</p>
                                <span class="bg-primary text-white text-xs rounded-full h-5 w-5 flex items-center justify-center ml-2">1</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat (David Wong) -->
                <div class="chat-item bg-lightSecondary p-3 rounded-lg cursor-pointer" data-user="david" data-name="David Wong" data-status="offline" data-image="https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=200&q=80">
                    <div class="flex items-center">
                        <div class="relative mr-3">
                            <img src="https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=200&q=80" class="w-12 h-12 rounded-full object-cover" alt="Profile photo">
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <h3 class="font-medium">David Wong</h3>
                                <span class="text-xs text-textLight">Yesterday</span>
                            </div>
                            <div class="flex justify-between">
                                <p class="text-sm text-textMedium truncate">Thanks for the introduction to the VC firm</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat (Aisha Johnson) -->
                <div class="chat-item bg-lightSecondary p-3 rounded-lg cursor-pointer" data-user="aisha" data-name="Aisha Johnson" data-status="online" data-image="https://images.unsplash.com/photo-1580489944761-15a19d654956?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=200&q=80">
                    <div class="flex items-center">
                        <div class="relative mr-3">
                            <img src="https://images.unsplash.com/photo-1580489944761-15a19d654956?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=200&q=80" class="w-12 h-12 rounded-full object-cover" alt="Profile photo">
                            <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <h3 class="font-medium">Aisha Johnson</h3>
                                <span class="text-xs text-textLight">Yesterday</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <p class="text-sm text-textMedium truncate">Would you be interested in joining our AI hackathon next month?</p>
                                <span class="bg-primary text-white text-xs rounded-full h-5 w-5 flex items-center justify-center ml-2">2</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat (Michael Lin) -->
                <div class="chat-item bg-lightSecondary p-3 rounded-lg cursor-pointer" data-user="michael" data-name="Michael Lin" data-status="offline" data-image="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=200&q=80">
                    <div class="flex items-center">
                        <div class="relative mr-3">
                            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=200&q=80" class="w-12 h-12 rounded-full object-cover" alt="Profile photo">
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <h3 class="font-medium">Michael Lin</h3>
                                <span class="text-xs text-textLight">2 days ago</span>
                            </div>
                            <div class="flex justify-between">
                                <p class="text-sm text-textMedium truncate">Let's schedule a call to discuss potential collaboration</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Active Chat View (Hidden initially, shown when a chat is clicked) -->
        <div id="chatView" class="fixed inset-0 bg-lightBg z-50 hidden">
            <div class="h-full flex flex-col">
                <!-- Chat Header -->
                <div class="bg-white p-4 border-b flex items-center">
                    <button id="backToChats" class="text-primary mr-3">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </button>
                    <img id="chatUserImage" src="" class="w-10 h-10 rounded-full object-cover mr-3" alt="Profile photo">
                    <div>
                        <h3 id="chatUserName" class="font-medium"></h3>
                        <p id="chatUserStatus" class="text-xs text-green-500"></p>
                    </div>
                    <div class="ml-auto flex space-x-4">
                        <button class="text-primary">
                            <i class="fas fa-phone"></i>
                        </button>
                        <button class="text-primary">
                            <i class="fas fa-video"></i>
                        </button>
                        <button class="text-primary">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Chat Messages -->
                <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4">
                    <!-- Messages will be populated by JavaScript -->
                </div>
                
                <!-- Message Input -->
                <div class="bg-white p-3 border-t">
                    <div class="flex items-center">
                        <button class="text-primary p-2">
                            <i class="fas fa-plus"></i>
                        </button>
                        <input type="text" id="messageInput" placeholder="Type a message..." class="flex-1 px-4 py-2 rounded-full border focus:outline-none focus:ring-2 focus:ring-primary">
                        <button class="text-primary p-2">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button id="sendMessageBtn" class="bg-primary text-white p-2 rounded-full ml-2">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t p-3 flex justify-around">
            <a href="index.html" class="text-textLight flex flex-col items-center">
                <i class="fas fa-home text-xl"></i>
                <span class="text-xs mt-1">Home</span>
            </a>
            <a href="chat.html" class="text-primary flex flex-col items-center">
                <i class="fas fa-comments text-xl"></i>
                <span class="text-xs mt-1">Chat</span>
            </a>
            <a href="search.html" class="text-textLight flex flex-col items-center">
                <i class="fas fa-search text-xl"></i>
                <span class="text-xs mt-1">Search</span>
            </a>
            <a href="profile.html" class="text-textLight flex flex-col items-center">
                <i class="fas fa-user text-xl"></i>
                <span class="text-xs mt-1">Profile</span>
            </a>
        </nav>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const authCheck = document.getElementById('authCheck');
            const messagesList = document.getElementById('messagesList');
            
            if (!currentUser) {
                // Show auth check message and hide messages list
                authCheck.classList.remove('hidden');
                messagesList.classList.add('hidden');
            } else {
                // Hide auth check message and show messages list
                authCheck.classList.add('hidden');
                messagesList.classList.remove('hidden');
            }
            
            // Chat messages templates
            const chatMessages = {
                sarah: [
                    {
                        sender: 'sarah',
                        content: 'Hi Alex! I was really impressed by your presentation at the product conference last week.',
                        time: '10:23 AM'
                    },
                    {
                        sender: 'me',
                        content: 'Thanks Sarah! It was a great event. Did you get a chance to connect with anyone interesting there?',
                        time: '10:25 AM'
                    },
                    {
                        sender: 'sarah',
                        content: 'Yes! I met the CTO of that healthtech startup we talked about. We should definitely explore potential collaboration opportunities with them.',
                        time: '10:28 AM'
                    },
                    {
                        sender: 'sarah',
                        content: 'Would you be free to grab coffee this week to discuss?',
                        time: '10:30 AM'
                    },
                    {
                        sender: 'me',
                        content: 'That sounds fantastic! I\'ve been wanting to expand into healthcare. I\'m free tomorrow afternoon if that works for you?',
                        time: '10:32 AM'
                    },
                    {
                        sender: 'sarah',
                        content: 'Perfect! Let\'s meet at Blue Bottle Coffee at 3pm. Looking forward to our coffee chat tomorrow!',
                        time: '10:35 AM'
                    }
                ],
                david: [
                    {
                        sender: 'david',
                        content: 'Hey Alex, thanks for making the introduction to the VC firm!',
                        time: '3:45 PM'
                    },
                    {
                        sender: 'me',
                        content: 'No problem, David! How did the meeting go?',
                        time: '4:00 PM'
                    },
                    {
                        sender: 'david',
                        content: 'It went really well! We have a follow-up meeting scheduled for next week. Your insight on their investment criteria was spot on.',
                        time: '4:05 PM'
                    },
                    {
                        sender: 'me',
                        content: 'That\'s great to hear! Keep me posted on how it progresses.',
                        time: '4:10 PM'
                    },
                    {
                        sender: 'david',
                        content: 'Will do. Let\'s catch up soon!',
                        time: '4:15 PM'
                    }
                ],
                aisha: [
                    {
                        sender: 'aisha',
                        content: 'Hi Alex! Long time no see. How have you been?',
                        time: '11:30 AM'
                    },
                    {
                        sender: 'me',
                        content: 'Hey Aisha! I\'ve been good, busy with the new product launch. How about you?',
                        time: '11:35 AM'
                    },
                    {
                        sender: 'aisha',
                        content: 'I\'ve been great! I\'m organizing an AI hackathon next month and wondered if you\'d be interested in joining or maybe even mentoring?',
                        time: '11:40 AM'
                    },
                    {
                        sender: 'aisha',
                        content: 'We\'re looking for product managers with tech experience to help guide the teams.',
                        time: '11:41 AM'
                    },
                    {
                        sender: 'me',
                        content: 'That sounds interesting! When exactly is it happening?',
                        time: '11:45 AM'
                    }
                ],
                michael: [
                    {
                        sender: 'michael',
                        content: 'Hello Alex, I\'d like to discuss a potential collaboration opportunity.',
                        time: '9:15 AM'
                    },
                    {
                        sender: 'me',
                        content: 'Hi Michael, I\'d be happy to hear more about it!',
                        time: '9:30 AM'
                    },
                    {
                        sender: 'michael',
                        content: 'Great! Our fintech company is expanding into new markets, and we\'re looking for product strategy consultants with your expertise.',
                        time: '9:35 AM'
                    },
                    {
                        sender: 'michael',
                        content: 'Let\'s schedule a call to discuss the details. How\'s your availability next week?',
                        time: '9:40 AM'
                    },
                    {
                        sender: 'me',
                        content: 'I\'m interested! I have some time on Tuesday afternoon or Thursday morning.',
                        time: '10:00 AM'
                    }
                ]
            };
            
            // New message button
            document.getElementById('newMessageBtn').addEventListener('click', function() {
                alert('New message functionality will be available soon.');
            });

            // Show chat view when clicking on a chat
            const chatItems = document.querySelectorAll('.chat-item');
            chatItems.forEach(chat => {
                chat.addEventListener('click', function() {
                    if (!currentUser) return; // Don't do anything if not logged in
                    
                    const userId = this.getAttribute('data-user');
                    const userName = this.getAttribute('data-name');
                    const userStatus = this.getAttribute('data-status');
                    const userImage = this.getAttribute('data-image');
                    
                    // Set chat user info
                    document.getElementById('chatUserName').textContent = userName;
                    document.getElementById('chatUserStatus').textContent = userStatus === 'online' ? 'Online' : 'Offline';
                    document.getElementById('chatUserImage').src = userImage;
                    
                    // Populate messages
                    const messagesContainer = document.getElementById('chatMessages');
                    messagesContainer.innerHTML = '';
                    
                    // Add date separator
                    const dateSeparator = document.createElement('div');
                    dateSeparator.className = 'flex justify-center';
                    dateSeparator.innerHTML = `
                        <span class="text-xs text-textLight bg-lightBg px-3 py-1 rounded-full">Today</span>
                    `;
                    messagesContainer.appendChild(dateSeparator);
                    
                    // Add chat messages
                    const messages = chatMessages[userId] || [];
                    messages.forEach(message => {
                        const messageElement = document.createElement('div');
                        
                        if (message.sender === 'me') {
                            // Sent message
                            messageElement.className = 'flex justify-end';
                            messageElement.innerHTML = `
                                <div class="max-w-[80%]">
                                    <div class="bg-primary text-white p-3 chat-bubble-sent">
                                        <p class="text-sm">${message.content}</p>
                                    </div>
                                    <span class="text-xs text-textLight mr-2 text-right block">${message.time}</span>
                                </div>
                            `;
                        } else {
                            // Received message
                            messageElement.className = 'flex items-end';
                            messageElement.innerHTML = `
                                <img src="${userImage}" class="w-8 h-8 rounded-full object-cover mr-2" alt="Profile photo">
                                <div class="max-w-[80%]">
                                    <div class="bg-lightSecondary p-3 chat-bubble-received">
                                        <p class="text-sm">${message.content}</p>
                                    </div>
                                    <span class="text-xs text-textLight ml-2">${message.time}</span>
                                </div>
                            `;
                        }
                        
                        messagesContainer.appendChild(messageElement);
                    });
                    
                    // Clear input field
                    document.getElementById('messageInput').value = '';
                    
                    // Show chat view
                    document.getElementById('chatView').classList.remove('hidden');
                    
                    // Scroll to bottom of messages
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                });
            });

            // Back button in chat view
            document.getElementById('backToChats').addEventListener('click', function() {
                document.getElementById('chatView').classList.add('hidden');
            });
            
            // Send message functionality
            document.getElementById('sendMessageBtn').addEventListener('click', function() {
                sendMessage();
            });
            
            // Also send message on Enter key
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Function to send a message
            function sendMessage() {
                const messageInput = document.getElementById('messageInput');
                const message = messageInput.value.trim();
                
                if (message === '') return;
                
                const messagesContainer = document.getElementById('chatMessages');
                
                // Create message element
                const messageElement = document.createElement('div');
                messageElement.className = 'flex justify-end';
                
                // Get current time
                const now = new Date();
                const hours = now.getHours() % 12 || 12;
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const ampm = now.getHours() >= 12 ? 'PM' : 'AM';
                const timeStr = `${hours}:${minutes} ${ampm}`;
                
                messageElement.innerHTML = `
                    <div class="max-w-[80%]">
                        <div class="bg-primary text-white p-3 chat-bubble-sent">
                            <p class="text-sm">${message}</p>
                        </div>
                        <span class="text-xs text-textLight mr-2 text-right block">${timeStr}</span>
                    </div>
                `;
                
                messagesContainer.appendChild(messageElement);
                
                // Clear input
                messageInput.value = '';
                
                // Scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // Simulate response after a delay
                setTimeout(() => {
                    // Create typing indicator
                    const typingElement = document.createElement('div');
                    typingElement.className = 'flex items-end typing-indicator';
                    
                    const userImage = document.getElementById('chatUserImage').src;
                    
                    typingElement.innerHTML = `
                        <img src="${userImage}" class="w-8 h-8 rounded-full object-cover mr-2" alt="Profile photo">
                        <div class="max-w-[80%]">
                            <div class="bg-lightSecondary p-3 chat-bubble-received flex space-x-1">
                                <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></span>
                                <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></span>
                                <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.4s"></span>
                            </div>
                        </div>
                    `;
                    
                    messagesContainer.appendChild(typingElement);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    
                    // After 1.5 seconds, remove typing indicator and show response
                    setTimeout(() => {
                        // Remove typing indicator
                        const typingIndicator = document.querySelector('.typing-indicator');
                        if (typingIndicator) {
                            typingIndicator.remove();
                        }
                        
                        // Add response
                        const responseElement = document.createElement('div');
                        responseElement.className = 'flex items-end';
                        
                        responseElement.innerHTML = `
                            <img src="${userImage}" class="w-8 h-8 rounded-full object-cover mr-2" alt="Profile photo">
                            <div class="max-w-[80%]">
                                <div class="bg-lightSecondary p-3 chat-bubble-received">
                                    <p class="text-sm">Thanks for your message! I'll get back to you soon.</p>
                                </div>
                                <span class="text-xs text-textLight ml-2">${timeStr}</span>
                            </div>
                        `;
                        
                        messagesContainer.appendChild(responseElement);
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    }, 1500);
                }, 1000);
            }
        });
    </script>
</body>
</html>
